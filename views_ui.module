<?php
// $Id: views_ui.module,v 1.61 2008-01-18 18:57:56 merlinofchaos Exp $

/**
 * @file views_ui.module
 *
 * Provide structure for the administrative interface to Views.
 */

function views_ui_menu() {
  $items = array();

  // Minor code reduction technique
  $base = array(
    'access callback' => 'user_access',
    'access arguments' => array('administer views'),
    'file' => 'includes/admin.inc',
  );

  $items['admin/build/views'] = $base + array(
    'title' => t('Views'),
    'page callback' => 'views_ui_list_views',
    'description' => t('Views are customized lists of content on your system; they are highly configurable and give you control over how lists of content are presented.'),
    'type' => MENU_NORMAL_ITEM
  );
  $items['admin/build/views/list'] = $base + array(
    'title' => t('List'),
    'page callback' => 'views_ui_list_views',
    'type' => MENU_DEFAULT_LOCAL_TASK,
    'weight' => '-1'
  );
  $items['admin/build/views/add'] = $base + array(
    'title' => t('Add'),
    'page callback' => 'views_ui_add_page',
    'type' => MENU_LOCAL_TASK
  );
  $items['admin/build/views/edit/%views_ui_cache'] = $base + array(
    'title' => t('Edit'),
    'page callback' => 'views_ui_edit_page',
    'page arguments' => array(4),
    'type' => MENU_CALLBACK
  );
  $items['admin/build/views/import'] = $base + array(
    'title' => t('Import'),
    'page callback' => 'views_ui_admin_import_page',
    'type' => MENU_LOCAL_TASK
  );
  $items['admin/build/views/tools'] = $base + array(
    'title' => t('Tools'),
    'page callback' => 'drupal_get_form',
    'callback arguments' => array('views_ui_admin_tools'),
    'type' => MENU_LOCAL_TASK
  );
  $items['admin/build/views/delete'] = $base + array(
    'title' => t('Edit view'),
    'page callback' => 'drupal_get_form',
    'callback arguments' => array('views_ui_admin_delete_confirm'),
    'type' => MENU_CALLBACK
  );
  $items['admin/build/views/enable'] = $base + array(
    'page callback' => 'views_ui_admin_enable_page',
    'type' => MENU_CALLBACK
  );
  $items['admin/build/views/disable'] = $base + array(
    'page callback' => 'views_ui_admin_disable_page',
    'type' => MENU_CALLBACK
  );
  return $items;
}

/*
 * Implementation of hook_perm()
 */
function views_ui_perm() {
  return array('administer views');
}

/**
 * Specialized menu callback to load a view either out of the cache or just
 * load it.
 */
function views_ui_cache_load($name) {
  views_include('cache');
  views_include('view');
  $view = views_object_cache_get('view', $name);
  if (empty($view)) {
    $view = views_get_view($name);
  }

  if (empty($view)) {
    return FALSE;
  }

  else {
    return $view;
  }
}

/**
 * Specialized cache function to add a flag to our view, include an appropriate
 * include, and cache more easily.
 */
function views_ui_cache_set($view) {
  views_include('cache');
  $view->changed = TRUE; // let any future object know that this view has changed.
  views_object_cache_set('view', $view->name, $view);
}
